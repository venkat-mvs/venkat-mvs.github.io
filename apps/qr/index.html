<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scan Me</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<style>
body{
    background-color: rgb(32, 31, 31);
}
.container, body,html{
    height: 100%;
}
.container{
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 30px;
    flex-direction: column;
}
#qr{
    margin: auto;
    background-color: white;
    padding: 10px;
    border-radius: 10px;
}
.copy{
    position: fixed;
    top: 5%;
    right: 10%;
    width: 50px;
    height: 50px;
}

.tooltip {
  position: relative;
  display: inline-block;
}

.tooltip .tooltiptext {
  visibility: hidden;
  width: 140px;
  background-color: #555;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px;
  position: absolute;
  z-index: 1;
  bottom: 150%;
  left: 50%;
  margin-left: -75px;
  opacity: 0;
  transition: opacity 0.3s;
}

.tooltip .tooltiptext::after {
  content: "";
  position: absolute;
  top: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: #555 transparent transparent transparent;
}

.tooltip:hover .tooltiptext {
  visibility: visible;
  opacity: 1;
}
</style>
<body>
    <div class="container">

    </div>
    <div class="copy" onclick="copyClip()"> 
        <span class="tooltiptext" id="myTooltip">Copy to clipboard</span>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path fill="#ffffff" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"/></svg>
    </div>

<script>

const params = queryParams();

function copyClip(){
    if(document.hasFocus())
    navigator.clipboard.writeText(params.upi || params.url).then(() => alert(`copied ${(params.upi == null)? "URL": "UPI"} `))
}


function queryParams(){
    const params = new URLSearchParams(window.location.search);
    return {
        "upi": params.get("upi") || params.get("upiid") || params.get("id") || params.get("upi_id") || params.get("upiId"),
        "amount": params.get("amount") || params.get("money") || params.get("pay"),
        "person": params.get("name") || params.get("to") || params.get("banking_name") || params.get("banking name"),
        "cu": params.get("cu") || "INR",
        "url": params.get("url")
    }
}

function generateUpiURL({upiid, name, amount, cu}){
    return `upi://pay?pa=${upiid}&pn=${name}&am=${amount}&cu=${cu}`;
}
function error(prompt){
    document.body.innerHTML = prompt
    document.body.style.background = "white";
    throw Error()
}

function validateUrl(){
    if(params.upi !== null && !(/[a-zA-Z0-9.\-_]{2,49}@[a-zA-Z._]{2,49}/.test(params.upi))){
        error(`<center>
            <h3>Missing details</h3>
            <p>UPI is incorrect check UPI:<a>${params.upi}</a> and reload the page.</p>
            </center>`);
    }
    else if(params.amount !== null && 
            params.upi !== null) {
        if(params.person === null){
            
        }
        params.url = generateUpiURL({
            upiid: params.upi,
            amount: params.amount,
            name: params.person,
            cu: params.cu
        })
    }
    else if(params.upi !== null){
        params.url = params.upi;
    } 
    else if(params.url !== null){
        return "url";
    }
    else{
        error(`<center>
            <h3>Missing details</h3>
            <p>Check URL and reload the page.</p>
            </center>`)
    }
}

function generateImage(url){
    var qrcode = new QRCode("qr", 
    { 
        text: url, 
        width: 256, 
        height: 256, 
        colorDark : "#000000", 
        colorLight : "#ffffff", 
        correctLevel : QRCode.CorrectLevel.H 
    });
    
    qrcode.clear()
    
    qrcode.makeCode(url);

    return qrcode;
}


window.onload = function(){
    validateUrl();
    const canvas = document.createElement("div")
    canvas.id="qr"
    canvas.classList.add("QR");
    document.body.querySelector(".container").appendChild(canvas);
    generateImage(params.url);
}


</script> 

</body>
</html>